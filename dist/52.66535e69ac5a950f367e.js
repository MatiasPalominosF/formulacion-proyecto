(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{A97n:function(t,e,o){"use strict";o.r(e),o.d(e,"SaleModule",function(){return A});var n=o("SVse"),r=o("mrSG"),i=o("s7LF"),c=o("G0yt"),a=o("N8BJ"),s=o("JX91"),l=o("lJxs"),d=o("8Y7J"),u=o("TwWe"),b=o("b3t4"),p=o("Umpa"),h=o("ScZz");function g(t,e){1&t&&(d.Xb(0,"div"),d.Uc(1,"El rut es requerido"),d.Wb())}function f(t,e){if(1&t&&(d.Xb(0,"small",32),d.Sc(1,g,2,0,"div",13),d.Wb()),2&t){var o=d.kc(2);d.Db(1),d.rc("ngIf",o.f.rut.errors.required)}}var m=function(t){return{"is-invalid":t}};function v(t,e){if(1&t){var o=d.Yb();d.Xb(0,"div",15),d.Xb(1,"div",27),d.Xb(2,"input",28),d.hc("input",function(){return d.Ic(o),d.kc().checkRun()}),d.Wb(),d.Xb(3,"div",29),d.Xb(4,"button",30),d.hc("click",function(){return d.Ic(o),d.kc().searchClient()}),d.Sb(5,"i",31),d.Wb(),d.Wb(),d.Sc(6,f,2,1,"small",19),d.Wb(),d.Wb()}if(2&t){var n=d.kc();d.Db(2),d.rc("ngClass",d.wc(2,m,n.submittedSearch&&n.f.rut.errors)),d.Db(4),d.rc("ngIf",n.submittedSearch&&n.f.rut.errors)}}function y(t,e){if(1&t){var o=d.Yb();d.Xb(0,"div"),d.Sb(1,"hr"),d.Xb(2,"button",33),d.hc("click",function(){return d.Ic(o),d.kc().deleteClientInFront()}),d.Xb(3,"span",4),d.Uc(4,"\xd7"),d.Wb(),d.Wb(),d.Xb(5,"div",10),d.Xb(6,"label",34),d.Uc(7,"Cliente"),d.Wb(),d.Xb(8,"div",15),d.Sb(9,"input",35),d.Wb(),d.Wb(),d.Xb(10,"div",10),d.Xb(11,"label",36),d.Uc(12,"Descuento"),d.Wb(),d.Xb(13,"div",15),d.Xb(14,"div",27),d.Xb(15,"input",37),d.hc("ngModelChange",function(t){return d.Ic(o),d.kc().checkDiscount(t)}),d.Wb(),d.Xb(16,"div",29),d.Xb(17,"span",38),d.Uc(18,"%"),d.Wb(),d.Wb(),d.Wb(),d.Wb(),d.Wb(),d.Sb(19,"hr"),d.Wb()}}function S(t,e){1&t&&(d.Xb(0,"div"),d.Sb(1,"hr"),d.Xb(2,"div",10),d.Xb(3,"label",39),d.Uc(4,"Monto con descuento"),d.Wb(),d.Xb(5,"div",15),d.Sb(6,"input",40),d.Wb(),d.Wb(),d.Sb(7,"hr"),d.Wb())}function k(t,e){1&t&&(d.Xb(0,"div"),d.Uc(1," El monto a pagar es requerido "),d.Wb())}function W(t,e){if(1&t&&(d.Xb(0,"small",32),d.Sc(1,k,2,0,"div",13),d.Wb()),2&t){var o=d.kc();d.Db(1),d.rc("ngIf",o.f.paidWith.errors.required)}}var C=function(){function t(t,e,o,n,r,i){this.formBuilder=t,this.activeModal=e,this.productService=o,this.saleService=n,this.clientService=r,this.notifyService=i,this.passEntry=new d.o,this.sedescuenta=0,this.submittedSearch=!1,this.submitted=!1,this.showData=!1,this.client={}}return t.prototype.ngOnInit=function(){console.log("this.saldoTotal",this.saldoTotal),this.payFormGroup=this.formBuilder.group({rut:["",i.G.required],amount:[""],paidWith:["",i.G.required],change:[""],discount:[""],nameclient:[""],withdiscount:[""]}),this.cargarDatos(),this.getUserLogged()},t.prototype.getUserLogged=function(){localStorage.getItem("currentUser")&&(this.currentUser=JSON.parse(localStorage.getItem("currentUser")))},Object.defineProperty(t.prototype,"f",{get:function(){return this.payFormGroup.controls},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fValue",{get:function(){return this.payFormGroup.value},enumerable:!1,configurable:!0}),t.prototype.cargarDatos=function(){this.f.amount.patchValue(this.saldoTotal)},t.prototype.onPaySubmit=function(){var t=this;this.submitted=!0,this.f.paidWith.invalid||(!0===this.showData?(this.productService.productListSelected.forEach(function(e){e.totalPrice<t.sedescuenta||(e.totalPrice=e.totalPrice-t.sedescuenta)}),this.updateStock(this.productService.productListSelected,this.currentUser.uid),this.productService.productListSelected.forEach(function(e){t.updateStockIngredients(e,t.currentUser.uid)}),this.addSale(this.productService.productListSelected,this.currentUser.uid),this.saldoTotal=0,this.passEntry.emit(!0),this.activeModal.close(!0)):(this.updateStock(this.productService.productListSelected,this.currentUser.uid),this.productService.productListSelected.forEach(function(e){t.updateStockIngredients(e,t.currentUser.uid)}),this.addSale(this.productService.productListSelected,this.currentUser.uid),this.saldoTotal=0,this.passEntry.emit(!0),this.activeModal.close(!0)))},t.prototype.searchClient=function(){var t=this;this.submittedSearch=!0,this.f.rut.invalid||(this.blockUISearchClient.start("Cargando..."),this.clientService.getOneClient(this.fValue.rut,this.currentUser.uid).subscribe(function(e){if(null==e)t.notifyService.showWarning("Aviso","\xa1Usuario no encontrado!"),t.clean();else{t.client=e,t.showData=!0,t.f.paidWith.patchValue(""),t.f.change.patchValue(""),t.f.discount.patchValue(e.percent),t.f.nameclient.patchValue(e.name+" "+e.lastname),t.sedescuenta=t.saldoTotal*(parseInt(e.percent,10)/100);var o=t.saldoTotal-t.sedescuenta;t.f.withdiscount.patchValue(o),t.saldoFlag=t.saldoTotal,t.saldoTotal=o}t.blockUISearchClient.stop()}))},t.prototype.checkDiscount=function(t){this.saldoTotal=this.saldoFlag,console.log("this.saldoTotal: ",this.saldoTotal),console.log("this.sedescuenta: ",this.sedescuenta);var e=parseInt(t,10);this.sedescuenta=this.saldoTotal*(e/100);var o=this.saldoTotal-this.sedescuenta;this.f.withdiscount.patchValue(o),this.saldoTotal=o},t.prototype.calcDiscount=function(t){return this.sedescuenta=this.saldoTotal*(parseInt(t.percent,10)/100),this.saldoTotal-this.sedescuenta},t.prototype.addSale=function(t,e){var o=this;t.forEach(function(t){var n=new Date;t.date=n,o.saleService.addSaleProduct(t,e)})},t.prototype.updateStock=function(t,e){var o=this;t.forEach(function(t){var n=t.quantity,r=o.stringToInt(t.stock),i=o.intToString(r-n);o.productService.updateFieldOnProduct(t.id,e,i)})},t.prototype.updateStockIngredients=function(t,e){var o=this;if(t.ingredients.length>0){var n=0,r="";t.ingredients.forEach(function(i){o.productService.getProductById2(e,i.id).then(function(t){t.forEach(function(t){o.product=t.data()})}).finally(function(){n=o.stringToInt(o.product.stock),r=o.intToString(n-i.quantity*t.quantity),console.log(r," ID: ",o.product.id," Nombre: ",o.product.name),o.productService.updateFieldOnProduct(o.product.id,e,r)})})}},t.prototype.clean=function(){this.client={},console.log("this.saldoTotal",this.saldoTotal),console.log("this.saldoFlag",this.saldoFlag),this.submittedSearch=!1,this.showData=!1,this.sedescuenta=0,this.f.rut.patchValue(""),this.f.paidWith.patchValue(""),this.f.change.patchValue(""),this.f.discount.patchValue(""),this.f.nameclient.patchValue(""),this.f.withdiscount.patchValue(""),console.log("this.saldoTotal",this.saldoTotal),this.saldoTotal=this.saldoFlag,console.log("this.saldoTotal",this.saldoTotal)},t.prototype.stringToInt=function(t){return parseInt(t,10)},t.prototype.intToString=function(t){return t+""},t.prototype.calChange=function(t){console.log("calcChange:",this.saldoTotal),this.f.change.patchValue(""==t?0:t-this.saldoTotal)},t.prototype.checkRun=function(){var t=this.payFormGroup.get("rut"),e=t.value.replace(".",""),o=(e=e.replace("-","")).slice(0,-1),n=e.slice(-1).toUpperCase();t.setValue(o+"-"+n)},t.prototype.deleteClientInFront=function(){console.log("Se presion\xf3"),this.clean()},t.prototype.keyPress=function(t){var e=String.fromCharCode(t.charCode);8===t.keyCode||/[0-9\+\-\ ]/.test(e)||t.preventDefault()},t.\u0275fac=function(e){return new(e||t)(d.Rb(i.g),d.Rb(c.c),d.Rb(u.a),d.Rb(b.a),d.Rb(p.a),d.Rb(h.a))},t.\u0275cmp=d.Lb({type:t,selectors:[["app-pay-sale"]],inputs:{saldoTotal:"saldoTotal"},outputs:{passEntry:"passEntry"},decls:41,vars:9,consts:[[1,"modal-header"],[1,"form-section"],[1,"mr-2","mt-6","feather","ft-shopping-cart"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"form","form-horizontal",3,"formGroup","ngSubmit"],[1,"row","justify-content-md-center"],[1,"col-md-12"],[1,"form-body"],[1,"form-group","row","mx-auto"],["for","eventRegInput4",1,"col-md-3","label-control"],["class","col-md-9",4,"blockUI","blockUIMessage"],[4,"ngIf"],["for","eventRegInput1",1,"col-md-3","label-control"],[1,"col-md-9"],["type","text","id","eventInput1","placeholder","Monto a pagar","formControlName","amount","readonly","",1,"form-control"],["for","eventRegInput2",1,"col-md-3","label-control"],["type","text","id","eventInput2","placeholder","Paga con","formControlName","paidWith",1,"form-control",3,"ngClass","keypress","ngModelChange"],["class","form-text text-muted danger","class","invalid-feedback",4,"ngIf"],["for","eventRegInput3",1,"col-md-3","label-control"],["type","text","id","eventInput3","placeholder","Vuelto","formControlName","change","readonly","",1,"form-control"],[1,"modal-footer"],["type","button",1,"btn","btn-sm","grey","btn-outline-secondary",3,"click"],[1,"feather","ft-x"],["type","submit",1,"btn","btn-sm","btn-outline-primary"],[1,"la","la-check"],[1,"input-group"],["type","text","id","eventInput4","formControlName","rut","placeholder","Rut",1,"form-control",3,"ngClass","input"],[1,"input-group-append"],["type","button",1,"btn","btn-icon","btn-primary","mr-1",3,"click"],[1,"la","la-search"],[1,"invalid-feedback"],["type","button","aria-label","Close","placement","top","ngbTooltip","Eliminar descuento",1,"close",3,"click"],["for","eventRegInput6",1,"col-md-3","label-control"],["type","text","id","eventInput6","placeholder","Nombre cliente","formControlName","nameclient","readonly","",1,"form-control"],["for","eventRegInput5",1,"col-md-3","label-control"],["type","text","id","eventInput5","placeholder","Descuento","formControlName","discount",1,"form-control",3,"ngModelChange"],["id","descuento",1,"input-group-text"],["for","eventRegInput7",1,"col-md-3","label-control"],["type","text","id","eventInput7","placeholder","Monto a pagar","formControlName","withdiscount","readonly","",1,"form-control"]],template:function(t,e){1&t&&(d.Xb(0,"div",0),d.Xb(1,"h4",1),d.Sb(2,"i",2),d.Uc(3,"Realizar pago "),d.Wb(),d.Xb(4,"button",3),d.hc("click",function(){return e.activeModal.dismiss("Cross click")}),d.Xb(5,"span",4),d.Uc(6,"\xd7"),d.Wb(),d.Wb(),d.Wb(),d.Xb(7,"div",5),d.Xb(8,"form",6),d.hc("ngSubmit",function(){return e.onPaySubmit()}),d.Xb(9,"div",7),d.Xb(10,"div",8),d.Xb(11,"div",9),d.Xb(12,"div",10),d.Xb(13,"label",11),d.Uc(14,"Buscar cliente"),d.Wb(),d.Sc(15,v,7,4,"div",12),d.Wb(),d.Sc(16,y,20,0,"div",13),d.Xb(17,"div",10),d.Xb(18,"label",14),d.Uc(19,"Monto a pagar"),d.Wb(),d.Xb(20,"div",15),d.Sb(21,"input",16),d.Wb(),d.Wb(),d.Sc(22,S,8,0,"div",13),d.Xb(23,"div",10),d.Xb(24,"label",17),d.Uc(25,"Paga con"),d.Wb(),d.Xb(26,"div",15),d.Xb(27,"input",18),d.hc("keypress",function(t){return e.keyPress(t)})("ngModelChange",function(t){return e.calChange(t)}),d.Wb(),d.Sc(28,W,2,1,"small",19),d.Wb(),d.Wb(),d.Xb(29,"div",10),d.Xb(30,"label",20),d.Uc(31,"Vuelto"),d.Wb(),d.Xb(32,"div",15),d.Sb(33,"input",21),d.Wb(),d.Wb(),d.Wb(),d.Xb(34,"div",22),d.Xb(35,"button",23),d.hc("click",function(){return e.activeModal.dismiss("click cancel")}),d.Sb(36,"i",24),d.Uc(37," Cerrar "),d.Wb(),d.Xb(38,"button",25),d.Sb(39,"i",26),d.Uc(40," Aceptar "),d.Wb(),d.Wb(),d.Wb(),d.Wb(),d.Wb(),d.Wb()),2&t&&(d.Db(8),d.rc("formGroup",e.payFormGroup),d.Db(7),d.rc("blockUI","searchClientInfo")("blockUIMessage","Loading"),d.Db(1),d.rc("ngIf",e.showData),d.Db(6),d.rc("ngIf",e.showData),d.Db(5),d.rc("ngClass",d.wc(7,m,e.submitted&&e.f.paidWith.errors)),d.Db(1),d.rc("ngIf",e.submitted&&e.f.paidWith.errors))},directives:[i.I,i.t,i.l,a.e,n.u,i.d,i.s,i.j,n.r,c.hb],styles:["[_nghost-%COMP%]     .btn-light:not(:disabled):not(.disabled):active{color:unset!important;background-color:unset!important;border-color:#d3d9df!important}[_nghost-%COMP%]     .btn-light:hover:not(.disabled):active{background-color:#e2e6ea!important;border-color:#dae0e5!important}[_nghost-%COMP%]     .btn-light{color:unset!important;background-color:unset!important;border-color:unset!important}[_nghost-%COMP%]     .bg-primary{background-color:#007bff!important}[_nghost-%COMP%]     .text-white{color:#fff!important}[_nghost-%COMP%]     .custom-day{text-align:center;padding:.185rem .25rem;display:inline-block;height:2rem;width:2rem}[_nghost-%COMP%]     .custom-day:active{color:#6d7183!important;background-color:#fff!important;border-block-color:#0275d8!important}.bg-light[_ngcontent-%COMP%]{background-color:#f8f9fa!important}[_nghost-%COMP%]     .hidden{display:block!important}.ngb-dp-weekday[_ngcontent-%COMP%]{color:#17a2b8}.ngb-dp-week-number[_ngcontent-%COMP%], .ngb-dp-weekday[_ngcontent-%COMP%]{line-height:2rem;text-align:center;font-style:italic}.small[_ngcontent-%COMP%]{font-size:80%;font-weight:400}.ngb-dp-day[_ngcontent-%COMP%]{cursor:pointer!important}.ngb-dp-month[_ngcontent-%COMP%]{pointer-events:none}.btn-light[_ngcontent-%COMP%]:hover{color:#212529!important;background-color:#e2e6ea!important;border-color:#dae0e5!important}.ngb-datepicker-month-view[_ngcontent-%COMP%]{pointer-events:auto}.ngb-dp-header[_ngcontent-%COMP%]{border-bottom:0;border-radius:.25rem .25rem 0 0;padding-top:.25rem}.custom-day[_ngcontent-%COMP%], .ngb-dp-day[_ngcontent-%COMP%], .ngb-dp-week-number[_ngcontent-%COMP%], .ngb-dp-weekday[_ngcontent-%COMP%]{width:2rem;height:2rem}.custom-day[_ngcontent-%COMP%]{text-align:center;padding:.185rem .25rem;display:inline-block}.custom-day.focused[_ngcontent-%COMP%]{background-color:#e6e6e6}.custom-day.range[_ngcontent-%COMP%], .custom-day[_ngcontent-%COMP%]:hover{background-color:#0275d8;color:#fff}.custom-day.faded[_ngcontent-%COMP%]{background-color:rgba(2,117,216,.5)}[_nghost-%COMP%]     .block-ui-wrapper{background:rgba(255,249,249,.5)!important}hr[_ngcontent-%COMP%]{margin-top:1rem;margin-bottom:1rem;border:0;border-top:1px solid rgba(0,0,0,.1)}"]}),Object(r.b)([Object(a.a)("searchClientInfo"),Object(r.d)("design:type",Object)],t.prototype,"blockUISearchClient",void 0),t}(),P=o("+7SE"),X=o("/DnI"),I=o("FhuM"),O=function(){function t(t){this.parent=t}return Object.defineProperty(t.prototype,"controlValue",{get:function(){return this.parent?this.parent.control.get(this.controlName).value:""},enumerable:!1,configurable:!0}),t.\u0275fac=function(e){return new(e||t)(d.Rb(i.c,8))},t.\u0275dir=d.Mb({type:t,selectors:[["label","controlName",""]],hostVars:1,hostBindings:function(t,e){2&t&&d.ac("textContent",e.controlValue)},inputs:{controlName:"controlName"}}),t}(),M=o("BCt1");function U(t,e){1&t&&(d.Xb(0,"div",10),d.Xb(1,"div",11),d.Xb(2,"div",12),d.Sb(3,"div"),d.Wb(),d.Wb(),d.Wb())}function w(t,e){if(1&t&&(d.Xb(0,"th",40),d.Uc(1),d.Wb()),2&t){var o=e.$implicit;d.Db(1),d.Wc(" ",o," ")}}function D(t,e){if(1&t){var o=d.Yb();d.Xb(0,"tr",41),d.Xb(1,"th",42),d.Uc(2),d.Wb(),d.Xb(3,"td"),d.Sb(4,"ngb-highlight",43),d.Wb(),d.Xb(5,"td"),d.Sb(6,"ngb-highlight",43),d.lc(7,"transform"),d.lc(8,"number"),d.Wb(),d.Xb(9,"td"),d.Sb(10,"ngb-highlight",43),d.Wb(),d.Xb(11,"td"),d.Xb(12,"button",44),d.hc("click",function(){d.Ic(o);var t=e.$implicit;return d.kc(2).previewAddProduct(t)}),d.Sb(13,"span",45),d.Wb(),d.Wb(),d.Wb()}if(2&t){var n=e.$implicit,r=e.index,i=d.kc(2);d.Db(2),d.Vc(r+1),d.Db(2),d.rc("result",n.name)("term",i.filter.value),d.Db(2),d.rc("result",d.mc(7,7,d.mc(8,9,n.total)))("term",i.filter.value),d.Db(4),d.rc("result",n.stock)("term",i.filter.value)}}function T(t,e){1&t&&(d.Xb(0,"div"),d.Uc(1," La cantidad del producto es requerida. "),d.Wb())}function _(t,e){if(1&t&&(d.Xb(0,"small",46),d.Sc(1,T,2,0,"div",47),d.Wb()),2&t){var o=d.kc(2);d.Db(1),d.rc("ngIf",o.f.quantity.errors.required)}}var V=function(t){return{"is-invalid":t}};function L(t,e){if(1&t){var o=d.Yb();d.Xb(0,"div",13),d.Xb(1,"m-card",14),d.hc("reloadFunction",function(t){return d.Ic(o),d.kc().reloadProductsInfo(t)}),d.Vb(2,15),d.Uc(3," B\xfasqueda de productos "),d.Ub(),d.Vb(4,16),d.Xb(5,"div",17),d.Xb(6,"div",18),d.Xb(7,"form"),d.Xb(8,"div",19),d.Uc(9," Buscar: "),d.Sb(10,"input",20),d.Wb(),d.Wb(),d.Xb(11,"div",21),d.Xb(12,"table",22),d.Xb(13,"thead"),d.Xb(14,"tr"),d.Sc(15,w,2,1,"th",23),d.Wb(),d.Wb(),d.Xb(16,"tbody"),d.Sc(17,D,14,11,"tr",24),d.lc(18,"slice"),d.lc(19,"async"),d.Wb(),d.Wb(),d.Xb(20,"div",25),d.Xb(21,"ngb-pagination",26),d.hc("pageChange",function(t){return d.Ic(o),d.kc().page=t}),d.Wb(),d.Xb(22,"select",27),d.hc("ngModelChange",function(t){return d.Ic(o),d.kc().pageSize=t}),d.Xb(23,"option",28),d.Uc(24," Mostrar todos los \xedtems "),d.Wb(),d.Xb(25,"option",28),d.Uc(26,"2 \xedtems por p\xe1gina"),d.Wb(),d.Xb(27,"option",28),d.Uc(28,"4 \xedtems por p\xe1gina"),d.Wb(),d.Xb(29,"option",28),d.Uc(30,"6 \xedtems por p\xe1gina"),d.Wb(),d.Wb(),d.Wb(),d.Wb(),d.Wb(),d.Wb(),d.Xb(31,"form",29),d.Xb(32,"div",17),d.Xb(33,"div",30),d.Xb(34,"label"),d.Uc(35,"Producto "),d.Wb(),d.Xb(36,"div",31),d.Sb(37,"input",32),d.Wb(),d.Wb(),d.Xb(38,"div",30),d.Xb(39,"label"),d.Uc(40,"Cantidad "),d.Wb(),d.Xb(41,"div",31),d.Sb(42,"input",33),d.Xb(43,"div",34),d.Xb(44,"span",35),d.Uc(45),d.Wb(),d.Wb(),d.Sc(46,_,2,1,"small",36),d.Wb(),d.Wb(),d.Xb(47,"div",30),d.Xb(48,"label"),d.Uc(49,"Precio venta "),d.Wb(),d.Xb(50,"div",31),d.Sb(51,"input",37),d.Wb(),d.Wb(),d.Xb(52,"div",30),d.Sb(53,"br"),d.Xb(54,"div",31),d.Xb(55,"button",38),d.hc("click",function(){return d.Ic(o),d.kc().addPreview()}),d.Sb(56,"i",39),d.Uc(57," Agregar producto "),d.Wb(),d.Wb(),d.Wb(),d.Wb(),d.Wb(),d.Ub(),d.Wb(),d.Wb()}if(2&t){var n=d.kc();d.Db(1),d.rc("options",n.options),d.Db(9),d.rc("formControl",n.filter),d.Db(5),d.rc("ngForOf",n.headElements),d.Db(2),d.rc("ngForOf",d.oc(18,16,d.mc(19,20,n.productSearch),(n.page-1)*n.pageSize,(n.page-1)*n.pageSize+n.pageSize)),d.Db(4),d.rc("collectionSize",n.collectionSize)("page",n.page)("pageSize",n.pageSize),d.Db(1),d.rc("ngModel",n.pageSize),d.Db(1),d.rc("ngValue",n.collectionSize),d.Db(2),d.rc("ngValue",2),d.Db(2),d.rc("ngValue",4),d.Db(2),d.rc("ngValue",6),d.Db(2),d.rc("formGroup",n.productInfo),d.Db(11),d.rc("ngClass",d.wc(22,V,n.submitted&&n.f.quantity.errors)),d.Db(3),d.Vc(n.unidad),d.Db(1),d.rc("ngIf",n.submitted&&n.f.quantity.errors)}}function x(t,e){if(1&t&&(d.Xb(0,"th",40),d.Uc(1),d.Wb()),2&t){var o=e.$implicit;d.Db(1),d.Wc(" ",o," ")}}function R(t,e){if(1&t){var o=d.Yb();d.Xb(0,"tr",41),d.Xb(1,"td",42),d.Uc(2),d.Wb(),d.Xb(3,"td"),d.Uc(4),d.Wb(),d.Xb(5,"td"),d.Uc(6),d.Wb(),d.Xb(7,"td"),d.Xb(8,"button",57),d.hc("click",function(){d.Ic(o);var t=e.index;return d.kc(2).onRemove(t)}),d.Sb(9,"span",58),d.Wb(),d.Wb(),d.Wb()}if(2&t){var n=e.$implicit;d.Db(2),d.Vc(n.name),d.Db(2),d.Vc(n.quantity),d.Db(2),d.Vc(n.totalPrice)}}function E(t,e){if(1&t){var o=d.Yb();d.Xb(0,"div",48),d.Xb(1,"m-card",14),d.hc("reloadFunction",function(t){return d.Ic(o),d.kc().reloadSelectProductInfo(t)}),d.Vb(2,15),d.Uc(3," Lista de productos "),d.Ub(),d.Vb(4,16),d.Xb(5,"div",17),d.Xb(6,"div",18),d.Xb(7,"div",21),d.Xb(8,"table",49),d.Xb(9,"thead"),d.Xb(10,"tr"),d.Sc(11,x,2,1,"th",23),d.Wb(),d.Wb(),d.Xb(12,"tbody"),d.Sc(13,R,10,3,"tr",24),d.Wb(),d.Wb(),d.Wb(),d.Wb(),d.Wb(),d.Xb(14,"form",29),d.Xb(15,"div",50),d.Xb(16,"div",17),d.Xb(17,"div",51),d.Xb(18,"div",17),d.Xb(19,"label",52),d.Xb(20,"b"),d.Uc(21,"Total:"),d.Wb(),d.Wb(),d.Xb(22,"div",53),d.Sb(23,"label",54),d.Wb(),d.Wb(),d.Wb(),d.Xb(24,"div",51),d.Xb(25,"div",17),d.Xb(26,"div",55),d.Xb(27,"button",38),d.hc("click",function(){return d.Ic(o),d.kc().onPay()}),d.Sb(28,"i",56),d.Uc(29," Pagar "),d.Wb(),d.Wb(),d.Wb(),d.Wb(),d.Wb(),d.Wb(),d.Wb(),d.Ub(),d.Wb(),d.Wb()}if(2&t){var n=d.kc();d.Db(1),d.rc("options",n.options),d.Db(10),d.rc("ngForOf",n.headElements2),d.Db(2),d.rc("ngForOf",n.productList),d.Db(1),d.rc("formGroup",n.productInfo2)}}var F=function(){function t(t,e,o,n,r){this.productService=t,this.formBuilder=e,this.notifyService=o,this.confirmationDialogService=n,this.modalService=r,this.loading=!1,this.submitted=!1,this.page=1,this.pageSize=4,this.precioTotal=0,this.closeResult="",this.filter=new i.h(""),this.productList=[],this.headElements=["#","Producto","Precio venta ($)","Stock","Acciones"],this.elements2=[{id:1,first:"Mark",last:"Otto"},{id:2,first:"Jacob",last:"Thornton"},{id:3,first:"Larry",last:"the Bird"}],this.headElements2=["Producto","Cantidad","Precio total ($)","Acciones"],this.options={close:!1,expand:!0,minimize:!0,reload:!0},this.productInfo=this.formBuilder.group({name:["",i.G.required],quantity:["",i.G.required],total:["",i.G.required]}),this.productInfo2=this.formBuilder.group({precioTotal:[""]})}return t.prototype.ngOnInit=function(){this.breadcrumb={mainlabel:"Gesti\xf3n de ventas",links:[{name:"Home",isLink:!0,link:"/dashboard/ecommerce"},{name:"Ventas",isLink:!1,link:""}]},console.log("Esto tiene al iniciar: "+this.productList.length),this.getUserLogged(),this.getAllProducts(),this.emptyListProducts()},t.prototype.getAllProducts=function(){var t=this;this.blockUIProductsInfo.start("Loading.."),this.productService.getFullInfoProduct(this.currentUser.uid).subscribe(function(e){t.PRODUCT=e,t.collectionSize=t.PRODUCT.length,t.searchData(t.pipe),t.productSortable=t.PRODUCT,t.blockUIProductsInfo.stop(),t.verifyMinimunStock(t.PRODUCT)})},t.prototype.refresh=function(){this.getAllProducts()},t.prototype.searchData=function(t){var e=this;console.log("this.productSearch ",this.productSearch),this.productSearch=this.filter.valueChanges.pipe(Object(s.a)(""),Object(l.a)(function(o){return e.search(o,t)}))},t.prototype.search=function(t,e){return this.PRODUCT.filter(function(e){var o=t.toLowerCase();return e.name.toLowerCase().includes(o)||e.total.toLowerCase().includes(o)||e.stock.toLowerCase().includes(o)})},t.prototype.getUserLogged=function(){localStorage.getItem("currentUser")&&(this.currentUser=JSON.parse(localStorage.getItem("currentUser")))},t.prototype.clearForm=function(){this.productInfo.controls.name.setValue(""),this.productInfo.controls.quantity.setValue(""),this.productInfo.controls.total.setValue("")},t.prototype.previewAddProduct=function(t){this.clearForm(),this.productInfo.controls.name.patchValue(t.name),this.productInfo.controls.total.patchValue(t.total),this.setMeasure(t),this.selectedProduct=t},t.prototype.setMeasure=function(t){switch(t.measure){case"1":this.unidad="Kg";break;case"2":this.unidad="Gr";break;case"3":this.unidad="Lt";break;case"4":this.unidad="Cc";break;case"5":this.unidad="Ml";break;case"6":this.unidad="Un"}},t.prototype.addPreview=function(){var t=this;if(console.log("this.selectedProduct",this.selectedProduct),null!=this.selectedProduct){if(this.submitted=!0,this.productInfo.invalid)return;if(this.productList.includes(this.selectedProduct))this.productList.forEach(function(e){if(e.id===t.selectedProduct.id){var o=parseInt(t.fValue.total),n=parseInt(t.fValue.quantity),r=o*n+e.totalPrice;console.log("suma precio total: ",r),e.totalPrice=r;var i=n+e.quantity;console.log("suma cantidad total: ",i),e.quantity=i,t.sumTotal(t.productList[t.productList.length-1],!0,o*n)}});else{this.selectedProduct.quantity=parseInt(this.fValue.quantity),this.selectedProduct.cancellation=!1;var e=parseInt(this.fValue.total),o=parseInt(this.fValue.quantity);this.selectedProduct.totalPrice=e*o,this.productList.push(this.selectedProduct),this.sumTotal(this.productList[this.productList.length-1],!1,0)}this.clearForm(),this.selectedProduct=void 0,this.unidad="",this.submitted=!1}else this.notifyService.showWarning("Aviso","\xa1Debe seleccionar un producto!")},t.prototype.sumTotal=function(t,e,o){this.precioTotal+=e?o:t.totalPrice,this.productInfo2.controls.precioTotal.setValue(this.precioTotal)},t.prototype.restTotal=function(t){this.precioTotal-=t.totalPrice,this.productInfo2.controls.precioTotal.setValue(this.precioTotal)},Object.defineProperty(t.prototype,"f",{get:function(){return this.productInfo.controls},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"g",{get:function(){return this.productInfo2.controls},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fValue",{get:function(){return this.productInfo.value},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"gValue",{get:function(){return this.productInfo2.value},enumerable:!1,configurable:!0}),t.prototype.onRemove=function(t){var e=this;this.confirmationDialogService.confirm("Confirmaci\xf3n","\xbfEst\xe1s seguro de eliminar el producto?").then(function(o){o&&(e.restTotal(e.productList[t]),e.productList.splice(t,1),e.notifyService.showSuccess("Eliminar","\xa1El producto se elimin\xf3 correctamente!"))}).catch(function(){console.log("Not ok")})},t.prototype.reloadProductsInfo=function(){this.refresh()},t.prototype.onPay=function(){var t=this;if(0==this.productList.length||this.productList.length<0)this.notifyService.showWarning("Aviso","\xa1Debe seleccionar un producto!");else{this.productService.productListSelected=this.productList;var e=this.modalService.open(C,{windowClass:"animated fadeInDown"});e.componentInstance.saldoTotal=this.gValue.precioTotal,e.result.then(function(e){console.log("result:",e),e&&(t.emptyListProducts(),console.log("this.precioTotal",t.precioTotal),t.notifyService.showSuccess("Pagar","\xa1Se ha realizado el pago correctamente!"))},function(e){t.closeResult="Dismissed "+t.getDismissReason(e),console.log(t.closeResult)})}},t.prototype.verifyMinimunStock=function(t){var e=this;t.forEach(function(t){parseInt(t.stock)==parseInt(t.minimun)?e.notifyService.showInfo("Stock m\xednimo","Stock m\xednimo alcanzado en: "+t.name):parseInt(t.stock)<parseInt(t.minimun)&&e.notifyService.showError("Stock cr\xedtico","El producto: "+t.name+", est\xe1 debajo del stock m\xednimo")})},t.prototype.emptyListProducts=function(){for(this.precioTotal=0,this.g.precioTotal.patchValue(this.precioTotal);this.productList.length>0;)this.productList.pop()},t.prototype.getDismissReason=function(t){return t===c.a.ESC?"by pressing ESC":t===c.a.BACKDROP_CLICK?"by clicking on a backdrop":"with: "+t},t.prototype.reloadSelectProductInfo=function(){this.blockUIProductsSale.start("Loading.."),this.emptyListProducts(),this.blockUIProductsSale.stop()},t.\u0275fac=function(e){return new(e||t)(d.Rb(u.a),d.Rb(i.g),d.Rb(h.a),d.Rb(P.a),d.Rb(c.w))},t.\u0275cmp=d.Lb({type:t,selectors:[["app-sale-list"]],decls:10,vars:6,consts:[[1,"app-content","content"],["class","loader-wrapper",4,"ngIf"],[1,"content-wrapper"],[1,"content-header","row","mb-1"],[1,"col-12",3,"breadcrumb"],[1,"content-body"],["id","left-right-offset",1,"left-right-offset"],["matchHeight","card",1,"row"],["class","col-md-8 col-xl-8 col-lg-12",4,"blockUI","blockUIMessage"],["class","col-md-4 col-xl-4 col-lg-12",4,"blockUI","blockUIMessage"],[1,"loader-wrapper"],[1,"loader-container"],[1,"ball-rotate","loader-danger"],[1,"col-md-8","col-xl-8","col-lg-12"],[3,"options","reloadFunction"],["mCardHeaderTitle",""],["mCardBody",""],[1,"row"],[1,"col"],[1,"form-group","form-inline"],["type","text",1,"form-control","ml-2",3,"formControl"],[1,"table-responsive","card-body"],[1,"table","table-striped"],["scope","col",4,"ngFor","ngForOf"],["mdbTableCol","",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-between","p-2"],[3,"collectionSize","page","pageSize","pageChange"],[1,"custom-select",2,"width","auto",3,"ngModel","ngModelChange"],[3,"ngValue"],[3,"formGroup"],[1,"col-md-3","m-auto"],[1,"input-group"],["type","text","placeholder","Nombre producto","formControlName","name","readonly","",1,"form-control"],["id","quantity","type","text","placeholder","Cantidad","formControlName","quantity",1,"form-control",3,"ngClass"],[1,"input-group-append"],["id","basic-addon2",1,"input-group-text"],["class","form-text text-muted danger","class","invalid-feedback",4,"ngIf"],["type","text","placeholder","Precio venta","formControlName","total","readonly","",1,"form-control"],[1,"btn","btn-primary","btn-min-width","mr-1","mb-1",3,"click"],[1,"la","la-plus"],["scope","col"],["mdbTableCol",""],["scope","row"],[3,"result","term"],[1,"btn","btn-xs","btn-social-icon","btn-instagram",3,"click"],[1,"la","la-cart-plus"],[1,"invalid-feedback"],[4,"ngIf"],[1,"col-md-4","col-xl-4","col-lg-12"],["mdbTable","","responsive","true",1,"table","table-striped"],[1,"form-group"],[1,"col-md-6"],[1,"col-md-6","text-right"],[1,"col-md-5"],["controlName","precioTotal"],[1,"col-md-8"],[1,"la","la-mouse-pointer"],[1,"btn","btn-xs","btn-social-icon","mr-1","mb-1","btn-pinterest",3,"click"],[1,"la","la-trash"]],template:function(t,e){1&t&&(d.Xb(0,"div",0),d.Sc(1,U,4,0,"div",1),d.Xb(2,"div",2),d.Xb(3,"div",3),d.Sb(4,"app-breadcrumb",4),d.Wb(),d.Xb(5,"div",5),d.Xb(6,"section",6),d.Xb(7,"div",7),d.Sc(8,L,58,24,"div",8),d.Sc(9,E,30,4,"div",9),d.Wb(),d.Wb(),d.Wb(),d.Wb(),d.Wb()),2&t&&(d.Db(1),d.rc("ngIf",e.loading),d.Db(3),d.rc("breadcrumb",e.breadcrumb),d.Db(4),d.rc("blockUI","productsInfo")("blockUIMessage","Loading"),d.Db(1),d.rc("blockUI","productsSale")("blockUIMessage","Loading"))},directives:[n.u,X.a,a.e,I.a,i.I,i.t,i.u,i.d,i.s,i.i,n.t,c.G,i.E,i.v,i.x,i.H,i.l,i.j,n.r,c.u,O],pipes:[n.F,n.b,M.a,n.g],styles:["[_nghost-%COMP%]     .btn-light:not(:disabled):not(.disabled):active{color:unset!important;background-color:unset!important;border-color:#d3d9df!important}[_nghost-%COMP%]     .btn-light:hover:not(.disabled):active{background-color:#e2e6ea!important;border-color:#dae0e5!important}[_nghost-%COMP%]     .btn-light{color:unset!important;background-color:unset!important;border-color:unset!important}[_nghost-%COMP%]     .bg-primary{background-color:#007bff!important}[_nghost-%COMP%]     .text-white{color:#fff!important}[_nghost-%COMP%]     .custom-day{text-align:center;padding:.185rem .25rem;display:inline-block;height:2rem;width:2rem}[_nghost-%COMP%]     .custom-day:active{color:#6d7183!important;background-color:#fff!important;border-block-color:#0275d8!important}.bg-light[_ngcontent-%COMP%]{background-color:#f8f9fa!important}[_nghost-%COMP%]     .hidden{display:block!important}.ngb-dp-weekday[_ngcontent-%COMP%]{color:#17a2b8}.ngb-dp-week-number[_ngcontent-%COMP%], .ngb-dp-weekday[_ngcontent-%COMP%]{line-height:2rem;text-align:center;font-style:italic}.small[_ngcontent-%COMP%]{font-size:80%;font-weight:400}.ngb-dp-day[_ngcontent-%COMP%]{cursor:pointer!important}.ngb-dp-month[_ngcontent-%COMP%]{pointer-events:none}.btn-light[_ngcontent-%COMP%]:hover{color:#212529!important;background-color:#e2e6ea!important;border-color:#dae0e5!important}.ngb-datepicker-month-view[_ngcontent-%COMP%]{pointer-events:auto}.ngb-dp-header[_ngcontent-%COMP%]{border-bottom:0;border-radius:.25rem .25rem 0 0;padding-top:.25rem}.custom-day[_ngcontent-%COMP%], .ngb-dp-day[_ngcontent-%COMP%], .ngb-dp-week-number[_ngcontent-%COMP%], .ngb-dp-weekday[_ngcontent-%COMP%]{width:2rem;height:2rem}.custom-day[_ngcontent-%COMP%]{text-align:center;padding:.185rem .25rem;display:inline-block}.custom-day.focused[_ngcontent-%COMP%]{background-color:#e6e6e6}.custom-day.range[_ngcontent-%COMP%], .custom-day[_ngcontent-%COMP%]:hover{background-color:#0275d8;color:#fff}.custom-day.faded[_ngcontent-%COMP%]{background-color:rgba(2,117,216,.5)}[_nghost-%COMP%]     .block-ui-wrapper{background:rgba(255,249,249,.5)!important}"]}),Object(r.b)([Object(a.a)("productsInfo"),Object(r.d)("design:type",Object)],t.prototype,"blockUIProductsInfo",void 0),Object(r.b)([Object(a.a)("productsSale"),Object(r.d)("design:type",Object)],t.prototype,"blockUIProductsSale",void 0),t}(),q=o("iInd"),j=o("ErSb"),z=o("kaWu"),N=o("vj4e"),G=o("YDLe"),B=o("KuZG"),A=function(){function t(){}return t.\u0275mod=d.Pb({type:t}),t.\u0275inj=d.Ob({factory:function(e){return new(e||t)},providers:[P.a],imports:[[n.c,j.a,N.a,c.z,G.a,c.K,i.C,B.a,i.n,c.y,a.d.forRoot({template:z.a}),q.l.forChild([{path:"sale-list",component:F}])]]}),t}()}}]);